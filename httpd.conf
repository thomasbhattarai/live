# ============================================================================
# Apache HTTP Server Configuration
# Discover Nepal Travel Website
# ============================================================================

ServerRoot "/etc/apache2"
Listen 80

LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule access_compat_module modules/mod_access_compat.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule reqtimeout_module modules/mod_reqtimeout.so
LoadModule filter_module modules/mod_filter.so
LoadModule mime_module modules/mod_mime.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule env_module modules/mod_env.so
LoadModule headers_module modules/mod_headers.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule version_module modules/mod_version.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule status_module modules/mod_status.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule dir_module modules/mod_dir.so
LoadModule alias_module modules/mod_alias.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule expires_module modules/mod_expires.so
LoadModule ssl_module modules/mod_ssl.so

<IfModule unixd_module>
    User www-data
    Group www-data
</IfModule>

ServerAdmin webmaster@discovernepal.com
ServerName discovernepal.com
ServerAlias www.discovernepal.com

<Directory />
    AllowOverride None
    Require all denied
</Directory>

DocumentRoot "/var/www/html/discovernepal"

<Directory "/var/www/html/discovernepal">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
    
    # Security Headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # CORS for necessary resources
    <FilesMatch "\.(json|xml)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
</Directory>

<IfModule dir_module>
    DirectoryIndex index.html index.php
</IfModule>

<Files ".ht*">
    Require all denied
</Files>

ErrorLog "/var/log/apache2/discovernepal-error.log"
LogLevel warn

<IfModule log_config_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common
    
    <IfModule logio_module>
        LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
    </IfModule>
    
    CustomLog "/var/log/apache2/discovernepal-access.log" combined
</IfModule>

<IfModule mime_module>
    TypesConfig /etc/mime.types
    
    AddType application/javascript .js
    AddType application/json .json
    AddType text/css .css
    AddType image/svg+xml .svg .svgz
    AddEncoding x-gzip .svgz
    AddType application/x-font-ttf .ttf .ttc
    AddType font/opentype .otf
    AddType application/x-font-woff .woff
    AddType application/vnd.ms-fontobject .eot
    AddType image/webp .webp
    AddType application/xml .xml
    AddType application/rss+xml .rss
    AddType application/atom+xml .atom
</IfModule>

# Enable gzip compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml application/rss+xml
</IfModule>

# Browser caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/json "access plus 1 month"
    ExpiresByType application/xml "access plus 1 month"
</IfModule>

# Virtual Host for HTTPS
<IfModule mod_ssl.c>
    <VirtualHost *:443>
        ServerName discovernepal.com
        ServerAlias www.discovernepal.com
        
        DocumentRoot "/var/www/html/discovernepal"
        
        SSLEngine on
        SSLCertificateFile /etc/ssl/certs/discovernepal.crt
        SSLCertificateKeyFile /etc/ssl/private/discovernepal.key
        SSLCertificateChainFile /etc/ssl/certs/discovernepal-chain.crt
        
        # HSTS Header
        Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        
        <Directory "/var/www/html/discovernepal">
            AllowOverride All
            Require all granted
        </Directory>
        
        ErrorLog "/var/log/apache2/discovernepal-ssl-error.log"
        CustomLog "/var/log/apache2/discovernepal-ssl-access.log" combined
    </VirtualHost>
</IfModule>

# PHP Configuration (if using PHP)
<IfModule mod_php7.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value max_input_time 300
</IfModule>

# Block specific user agents
<IfModule mod_setenvif.c>
    SetEnvIfNoCase User-Agent "^.*(AhrefsBot|SemrushBot|MJ12bot).*$" bad_bot
    Deny from env=bad_bot
</IfModule>